<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Athplan - The AI Operations Assistant</title>
    <meta name="description" content="The AI Operations Assistant for High-Performance Teams." />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: { slate: { 850: '#151f32', 900: '#0f172a', 950: '#020617' } },
                    backgroundImage: {
                        'grid-pattern': "linear-gradient(to right, #1e293b 1px, transparent 1px), linear-gradient(to bottom, #1e293b 1px, transparent 1px)",
                    }
                },
            },
        }
    </script>

    <!-- Custom CSS -->
    <style>
        /* Base Overrides */
        body {
            background-color: #020617;
            color: #f8fafc;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0f172a;
        }

        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #475569;
        }

        /* Animations */
        @keyframes fade-in-up {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fade-in {
            0% {
                opacity: 0;
            }

            100% {
                opacity: 1;
            }
        }

        .animate-fade-in-up {
            animation: fade-in-up 0.8s ease-out forwards;
            opacity: 0;
        }

        .animate-fade-in {
            animation: fade-in 1s ease-out forwards;
        }

        .delay-100 {
            animation-delay: 100ms;
        }

        .delay-200 {
            animation-delay: 200ms;
        }

        .delay-300 {
            animation-delay: 300ms;
        }

        /* Scroll Trigger Utility */
        .transition-element {
            transition: all 1s ease-out;
            opacity: 0;
            transform: translateY(48px);
        }

        .transition-element.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Utility */
        .shadow-glow {
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        .shadow-glow:hover {
            box-shadow: 0 0 25px rgba(255, 255, 255, 0.45);
        }

        .hidden {
            display: none !important;
        }

        /* Custom Radio Styling for Payment */
        input[type="radio"]:checked+div {
            color: white;
        }

        label:has(input[type="radio"]:checked) {
            border-color: #6366f1;
            background-color: rgba(99, 102, 241, 0.1);
        }

        /* Range Input Styling */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #6366f1;
            cursor: pointer;
            margin-top: -8px;
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.5);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #334155;
            border-radius: 2px;
        }

        /* Drag Active State */
        .drag-active {
            border-color: #6366f1 !important;
            background-color: rgba(99, 102, 241, 0.1) !important;
        }
    </style>
    <script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.1",
    "react/": "https://aistudiocdn.com/react@^19.2.1/"
  }
}
</script>
    <link rel="stylesheet" href="/index.css">
    <script type="module" src="/index.tsx"></script>
</head>

<body class="bg-slate-950 text-slate-50 selection:bg-indigo-500/30">
    <div id="payment-root"></div>

    <!-- ONBOARDING MODAL -->
    <div id="onboarding-modal"
        class="hidden fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-950/90 backdrop-blur-md">
        <div
            class="max-w-2xl w-full bg-slate-900 border border-slate-800 rounded-2xl p-8 shadow-2xl animate-fade-in-up">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-white mb-2">Welcome to your Trial! ðŸš€</h2>
                <p class="text-slate-400">How would you like to start exploring Athplan?</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Demo Mode -->
                <button onclick="setSetupMode('demo')"
                    class="group p-6 rounded-xl bg-slate-800/50 border border-slate-700 hover:border-indigo-500 hover:bg-slate-800 transition-all text-left">
                    <div
                        class="w-12 h-12 bg-indigo-500/20 rounded-lg flex items-center justify-center text-indigo-400 mb-4 group-hover:scale-110 transition-transform">
                        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                    </div>
                    <h3 class="text-lg font-bold text-white mb-2">Explore Demo Mode</h3>
                    <p class="text-sm text-slate-400">Pre-populated with example players and schedules. Best for
                        understanding how the features work.</p>
                </button>
                <!-- Blank Mode -->
                <button onclick="setSetupMode('blank')"
                    class="group p-6 rounded-xl bg-slate-800/50 border border-slate-700 hover:border-green-500 hover:bg-slate-800 transition-all text-left">
                    <div
                        class="w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center text-green-400 mb-4 group-hover:scale-110 transition-transform">
                        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                        </svg>
                    </div>
                    <h3 class="text-lg font-bold text-white mb-2">Start From Scratch</h3>
                    <p class="text-sm text-slate-400">Empty dashboard. Ready for you to upload your real schedule and
                        invite actual players.</p>
                </button>
            </div>
        </div>
    </div>

    <!-- NAVIGATION (Landing Page) -->
    <nav id="navbar" class="fixed top-0 w-full z-50 transition-all duration-300 bg-transparent py-5">
        <div class="max-w-7xl mx-auto px-6 flex items-center justify-between">
            <div class="flex items-center gap-2 cursor-pointer" onclick="navigateTo('home-view')">
                <!-- Logo -->
                <svg viewBox="0 0 40 40" fill="none" class="w-9 h-9" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 4L5 12.66V27.34L20 36V23L13 19V15L20 11V4Z" fill="url(#paint0_linear)" />
                    <path d="M20 4V11L27 15V19L20 23V36L35 27.34V12.66L20 4Z" fill="url(#paint1_linear)" />
                    <defs>
                        <linearGradient id="paint0_linear" x1="5" y1="4" x2="20" y2="36" gradientUnits="userSpaceOnUse">
                            <stop stop-color="#1e1b4b" />
                            <stop offset="1" stop-color="#312e81" />
                        </linearGradient>
                        <linearGradient id="paint1_linear" x1="20" y1="4" x2="35" y2="36"
                            gradientUnits="userSpaceOnUse">
                            <stop stop-color="#99f6e4" />
                            <stop offset="1" stop-color="#5eead4" />
                        </linearGradient>
                    </defs>
                </svg>
                <span class="font-bold text-xl tracking-tight text-white">Athplan</span>
            </div>

            <!-- Desktop Links -->
            <div id="nav-links" class="hidden md:flex items-center gap-8">
                <a href="#features" onclick="scrollToId('features')"
                    class="text-sm text-slate-300 hover:text-white transition-colors cursor-pointer">Features</a>
                <a href="#how-it-works" onclick="scrollToId('how-it-works')"
                    class="text-sm text-slate-300 hover:text-white transition-colors cursor-pointer">How it Works</a>
                <a href="#pricing" onclick="scrollToId('pricing')"
                    class="text-sm text-slate-300 hover:text-white transition-colors cursor-pointer">Pricing</a>
            </div>

            <!-- Auth Buttons -->
            <div class="flex items-center gap-4">
                <div id="auth-buttons-guest" class="flex items-center gap-4">
                    <button onclick="navigateTo('login-view')"
                        class="hidden sm:block text-sm font-medium text-slate-300 hover:text-white">Login</button>
                    <button onclick="navigateTo('signup-view')"
                        class="px-4 py-2 text-sm font-medium rounded-full bg-white text-slate-900 hover:bg-indigo-50 shadow-glow transition-all">Start
                        14-Day Free Trial</button>
                </div>
                <div id="auth-buttons-user" class="hidden flex items-center gap-4">
                    <button onclick="navigateTo('dashboard-view')"
                        class="text-sm font-medium text-indigo-400 hover:text-indigo-300">Dashboard</button>
                    <button onclick="logout()" class="text-sm font-medium text-slate-300 hover:text-white">Log
                        Out</button>
                </div>

                <!-- Mobile Menu Button -->
                <button class="md:hidden text-slate-300"
                    onclick="document.getElementById('mobile-menu').classList.toggle('hidden')">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Mobile Menu Overlay -->
        <div id="mobile-menu"
            class="hidden absolute top-full left-0 w-full bg-slate-950 border-b border-slate-800 p-4 flex flex-col gap-4 shadow-xl z-50">
            <a href="#features" onclick="scrollToId('features')" class="text-slate-300">Features</a>
            <a href="#how-it-works" onclick="scrollToId('how-it-works')" class="text-slate-300">How it Works</a>
            <a href="#pricing" onclick="scrollToId('pricing')" class="text-slate-300">Pricing</a>
        </div>
    </nav>

    <!-- === VIEW 1: HOME === -->
    <div id="home-view" class="view-section">
        <main class="flex flex-col items-center w-full overflow-hidden">
            <!-- Hero -->
            <section class="relative w-full pt-32 pb-20 md:pt-48 md:pb-32 px-6 overflow-hidden">
                <div
                    class="absolute top-0 left-1/2 -translate-x-1/2 w-full max-w-3xl h-[500px] bg-indigo-500/20 blur-[120px] rounded-full pointer-events-none -z-10 animate-fade-in">
                </div>
                <div class="max-w-4xl mx-auto text-center flex flex-col items-center z-10 relative">
                    <div
                        class="animate-fade-in-up inline-flex items-center gap-2 px-3 py-1 rounded-full bg-slate-900/50 border border-slate-800 mb-8 backdrop-blur-sm">
                        <span class="flex h-2 w-2 rounded-full bg-green-500 animate-pulse"></span>
                        <span class="text-xs font-medium text-slate-300">Now accepting pilot teams for 2026
                            Season</span>
                    </div>
                    <h1
                        class="animate-fade-in-up delay-100 text-5xl md:text-7xl font-extrabold text-white mb-6 leading-[1.1]">
                        Stop acting as a dispatcher. <br class="hidden md:block" />
                        <span
                            class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-300 via-white to-indigo-300">Start
                            managing.</span>
                    </h1>
                    <p class="animate-fade-in-up delay-200 text-lg md:text-xl text-slate-400 max-w-2xl mb-10">The AI
                        Operations Assistant for High-Performance Teams. Zero apps to download. 100% WhatsApp.</p>
                    <div class="animate-fade-in-up delay-300 flex flex-col items-center gap-4">
                        <div class="flex flex-col sm:flex-row gap-4 items-center">
                            <button onclick="navigateTo('signup-view')"
                                class="px-6 py-3 text-base font-medium rounded-full bg-white text-slate-900 hover:bg-indigo-50 shadow-glow transition-all w-full sm:w-auto">Start
                                Free Pilot</button>
                            <button onclick="scrollToId('how-it-works')"
                                class="group px-6 py-3 text-base font-medium rounded-full bg-slate-800 text-white hover:bg-slate-700 border border-slate-700 transition-all flex items-center gap-2 w-full sm:w-auto justify-center">
                                See it in action
                            </button>
                        </div>
                        <p class="text-sm text-slate-500 mt-2">Includes 14-day free trial. Cancel anytime.</p>
                    </div>
                </div>
                <div
                    class="absolute inset-0 bg-grid-pattern [mask-image:linear-gradient(to_bottom,white,transparent)] -z-20 opacity-20">
                </div>
            </section>

            <!-- Features -->
            <section id="features" class="py-24 px-6 w-full max-w-7xl mx-auto scroll-trigger">
                <div class="mb-16 text-center transition-element">
                    <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">Built for the modern Manager</h2>
                    <p class="text-slate-400 max-w-xl mx-auto">We handle the repetitive logistics questions so you can
                        focus on strategy.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div
                        class="md:col-span-2 p-8 rounded-3xl bg-slate-900 border border-slate-800 transition-element delay-100">
                        <div
                            class="w-12 h-12 rounded-2xl bg-green-500/10 flex items-center justify-center mb-6 text-green-400">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <rect x="5" y="2" width="14" height="20" rx="2" ry="2" />
                                <line x1="12" y1="18" x2="12.01" y2="18" />
                            </svg>
                        </div>
                        <h3 class="text-2xl font-bold text-white mb-2">Zero-Friction WhatsApp Interface</h3>
                        <p class="text-slate-400">No new apps to download. Athplan lives on WhatsApp.</p>
                    </div>
                    <div class="p-8 rounded-3xl bg-slate-900 border border-slate-800 transition-element delay-200">
                        <div
                            class="w-12 h-12 rounded-2xl bg-blue-500/10 flex items-center justify-center mb-6 text-blue-400">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />
                            </svg>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-2">Instant Answers</h3>
                        <p class="text-slate-400">Bus times, hotel addresses, wifi passwords. Answered instantly.</p>
                    </div>
                </div>
            </section>

            <!-- How It Works -->
            <section id="how-it-works" class="py-24 px-6 border-t border-slate-900 bg-slate-950/50">
                <div class="max-w-5xl mx-auto">
                    <div class="text-center mb-16">
                        <span class="text-indigo-400 font-medium text-sm tracking-wider uppercase mb-2 block">Simple
                            Setup</span>
                        <h2 class="text-3xl md:text-4xl font-bold text-white">Up and running in 5 minutes</h2>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                        <div class="p-6">
                            <div
                                class="w-16 h-16 rounded-2xl bg-slate-900 border border-slate-800 flex items-center justify-center mx-auto mb-6 text-slate-300">
                                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                                    <line x1="16" y1="2" x2="16" y2="6" />
                                    <line x1="8" y1="2" x2="8" y2="6" />
                                    <line x1="3" y1="10" x2="21" y2="10" />
                                </svg>
                            </div>
                            <h3 class="text-lg font-bold text-white mb-2">1. Send Schedule</h3>
                            <p class="text-sm text-slate-400">Email your PDF or Excel itinerary.</p>
                        </div>
                        <div class="p-6">
                            <div
                                class="w-16 h-16 rounded-2xl bg-slate-900 border border-slate-800 flex items-center justify-center mx-auto mb-6 text-slate-300">
                                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <rect x="3" y="11" width="18" height="10" rx="2" />
                                    <circle cx="12" cy="5" r="2" />
                                    <path d="M12 7v4" />
                                </svg>
                            </div>
                            <h3 class="text-lg font-bold text-white mb-2">2. We Activate Pilot</h3>
                            <p class="text-sm text-slate-400">System parses data instantly.</p>
                        </div>
                        <div class="p-6">
                            <div
                                class="w-16 h-16 rounded-2xl bg-slate-900 border border-slate-800 flex items-center justify-center mx-auto mb-6 text-slate-300">
                                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path
                                        d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z" />
                                </svg>
                            </div>
                            <h3 class="text-lg font-bold text-white mb-2">3. Team Asks</h3>
                            <p class="text-sm text-slate-400">Players ask questions via WhatsApp.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ROI CALCULATOR SECTION -->
            <section id="roi-calculator" class="py-20 px-6 w-full max-w-7xl mx-auto">
                <div
                    class="bg-slate-900 border border-slate-800 rounded-3xl p-8 md:p-12 shadow-2xl overflow-hidden relative">
                    <!-- Background Glow -->
                    <div
                        class="absolute top-0 right-0 w-96 h-96 bg-indigo-500/10 blur-[100px] rounded-full pointer-events-none -z-10">
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
                        <!-- Controls -->
                        <div>
                            <h2 class="text-3xl font-bold text-white mb-4">Calculate your ROI</h2>
                            <p class="text-slate-400 mb-8 leading-relaxed">
                                See how much time and money you save by automating logistics.
                                Based on an average manager rate of <span class="text-white font-semibold">$40/hr</span>
                                and <span class="text-white font-semibold">2 minutes</span> per message.
                            </p>

                            <div class="space-y-8">
                                <!-- Users Slider -->
                                <div class="space-y-4">
                                    <div class="flex justify-between items-center">
                                        <label for="roi-users" class="font-medium text-white">Team Size</label>
                                        <span id="roi-users-val"
                                            class="text-indigo-400 font-mono font-bold bg-indigo-500/10 px-3 py-1 rounded-lg">15
                                            Users</span>
                                    </div>
                                    <input id="roi-users" type="range" min="2" max="50" value="15"
                                        class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-indigo-500">
                                    <div class="flex justify-between text-xs text-slate-500">
                                        <span>2</span>
                                        <span>50</span>
                                    </div>
                                </div>

                                <!-- Messages Slider -->
                                <div class="space-y-4">
                                    <div class="flex justify-between items-center">
                                        <label for="roi-msgs" class="font-medium text-white">Avg. Messages / User /
                                            Week</label>
                                        <span id="roi-msgs-val"
                                            class="text-indigo-400 font-mono font-bold bg-indigo-500/10 px-3 py-1 rounded-lg">10
                                            msgs</span>
                                    </div>
                                    <input id="roi-msgs" type="range" min="5" max="50" value="10"
                                        class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-indigo-500">
                                    <div class="flex justify-between text-xs text-slate-500">
                                        <span>5 (Light)</span>
                                        <span>50 (Heavy)</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Results Card -->
                        <div class="bg-slate-950 border border-slate-800 rounded-2xl p-8 relative overflow-hidden">
                            <div
                                class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-indigo-500 via-purple-500 to-indigo-500">
                            </div>

                            <div class="mb-6 pb-6 border-b border-slate-800">
                                <span class="text-slate-400 text-sm uppercase tracking-wider font-semibold">Recommended
                                    Plan</span>
                                <div class="flex justify-between items-end mt-2">
                                    <h3 id="roi-plan-name" class="text-2xl font-bold text-white">All Star</h3>
                                    <div class="text-right">
                                        <span id="roi-plan-cost" class="text-3xl font-bold text-white">$199</span>
                                        <span id="roi-plan-period" class="text-slate-500 text-sm">/mo</span>
                                    </div>
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-4 mb-8">
                                <div class="bg-slate-900/50 p-4 rounded-xl border border-slate-800">
                                    <div class="flex items-center gap-2 mb-2 text-slate-400 text-sm">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <circle cx="12" cy="12" r="10" />
                                            <polyline points="12 6 12 12 16 14" />
                                        </svg> Time Saved
                                    </div>
                                    <div class="text-2xl font-bold text-white"><span id="roi-time-saved">20.0</span>
                                        <span class="text-sm font-normal text-slate-500">hrs/mo</span>
                                    </div>
                                </div>
                                <div class="bg-slate-900/50 p-4 rounded-xl border border-slate-800">
                                    <div class="flex items-center gap-2 mb-2 text-slate-400 text-sm">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />
                                        </svg> Value
                                    </div>
                                    <div class="text-2xl font-bold text-green-400">$<span
                                            id="roi-value-saved">800</span> <span
                                            class="text-sm font-normal text-slate-500">/mo</span></div>
                                </div>
                            </div>

                            <div class="bg-indigo-600 rounded-xl p-6 text-center">
                                <p class="text-indigo-100 text-sm mb-1 font-medium">Net Monthly Benefit</p>
                                <div class="text-4xl font-extrabold text-white">
                                    $<span id="roi-net-savings">601</span>
                                </div>
                                <p class="text-xs text-indigo-200 mt-2 opacity-80">
                                    (Value Saved - Subscription Cost)
                                </p>
                            </div>

                        </div>
                    </div>
                </div>
            </section>

            <!-- Pricing -->
            <section id="pricing" class="py-24 px-6 w-full max-w-7xl mx-auto">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">Simple, Transparent Pricing</h2>
                </div>
                <div id="pricing-container" class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- Pricing Cards will be loaded here -->
                    <div class="col-span-3 text-center text-slate-500">Loading pricing...</div>
                </div>
            </section>

            <!-- Footer -->
            <footer class="w-full border-t border-slate-900 bg-slate-950 py-12 px-6">
                <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between gap-12">
                    <div>
                        <span class="font-bold text-lg text-slate-200">Athplan</span>
                        <p class="text-slate-400 text-sm max-w-xs mt-2">The AI Operations Assistant.</p>
                        <div class="flex gap-4 mt-6">
                            <a href="#" class="text-slate-400 hover:text-white transition-colors">LinkedIn</a>
                            <a href="#" class="text-slate-400 hover:text-white transition-colors">Twitter</a>
                        </div>
                    </div>
                </div>
            </footer>
        </main>
    </div>

    <!-- === VIEW 2: LOGIN === -->
    <div id="login-view" class="view-section hidden min-h-screen flex items-center justify-center p-6 bg-slate-950">
        <div class="w-full max-w-md">
            <div class="text-center mb-10 cursor-pointer" onclick="navigateTo('home-view')">
                <h2 class="text-3xl font-bold text-white">Athplan</h2>
            </div>
            <div class="bg-slate-900/50 border border-slate-800 rounded-2xl p-8 shadow-xl">
                <h2 class="text-2xl font-bold text-white mb-6">Welcome back</h2>
                <button onclick="handleGoogleAuth()"
                    class="w-full flex items-center justify-center gap-3 bg-white text-slate-900 font-medium py-3 rounded-lg hover:bg-slate-100 transition-colors mb-6">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12.24 10.285V14.4h6.806c-.275 1.765-2.056 5.174-6.806 5.174-4.095 0-7.439-3.389-7.439-7.574s3.345-7.574 7.439-7.574c2.33 0 3.891.989 4.785 1.849l3.254-3.138C18.189 1.186 15.479 0 12.24 0c-6.635 0-12 5.365-12 12s5.365 12 12 12c6.926 0 11.52-4.869 11.52-11.726 0-.788-.085-1.39-.189-1.989H12.24z" />
                    </svg> Sign in with Google
                </button>
                <div class="relative flex py-2 items-center mb-6">
                    <div class="flex-grow border-t border-slate-800"></div>
                    <span class="flex-shrink-0 mx-4 text-slate-500 text-xs uppercase">Or continue with email</span>
                    <div class="flex-grow border-t border-slate-800"></div>
                </div>
                <form id="login-form" class="space-y-5">
                    <input type="email" id="login-email" autocomplete="email" placeholder="Email Address"
                        class="w-full px-4 py-3 bg-slate-950 border border-slate-800 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-indigo-500"
                        required>
                    <input type="password" id="login-password" autocomplete="current-password" placeholder="Password"
                        class="w-full px-4 py-3 bg-slate-950 border border-slate-800 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-indigo-500"
                        required>
                    <div id="login-error" class="hidden text-red-400 text-sm text-center bg-red-500/10 p-2 rounded">
                        Invalid credentials</div>
                    <button type="submit"
                        class="w-full py-3 bg-white text-slate-900 rounded-full font-medium hover:bg-indigo-50 transition-colors">Sign
                        In</button>
                </form>
                <div class="mt-6 text-center"><button onclick="navigateTo('signup-view')"
                        class="text-indigo-400 hover:text-indigo-300">No account? Sign up</button></div>
            </div>
        </div>
    </div>

    <!-- === VIEW 3: SIGNUP === -->
    <div id="signup-view" class="view-section hidden min-h-screen flex items-center justify-center p-6 bg-slate-950">
        <div class="w-full max-w-md">
            <div class="text-center mb-10 cursor-pointer" onclick="navigateTo('home-view')">
                <h2 class="text-3xl font-bold text-white">Athplan</h2>
            </div>
            <div class="bg-slate-900/50 border border-slate-800 rounded-2xl p-8 shadow-xl">
                <!-- Step 1 -->
                <div id="signup-step-1">
                    <h2 class="text-2xl font-bold text-white mb-2">Start Free Trial</h2>
                    <p class="text-slate-400 text-sm mb-6">14 days free, cancel anytime.</p>
                    <button onclick="handleGoogleAuth()"
                        class="w-full flex items-center justify-center gap-3 bg-white text-slate-900 font-medium py-3 rounded-lg hover:bg-slate-100 transition-colors mb-6">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M12.24 10.285V14.4h6.806c-.275 1.765-2.056 5.174-6.806 5.174-4.095 0-7.439-3.389-7.439-7.574s3.345-7.574 7.439-7.574c2.33 0 3.891.989 4.785 1.849l3.254-3.138C18.189 1.186 15.479 0 12.24 0c-6.635 0-12 5.365-12 12s5.365 12 12 12c6.926 0 11.52-4.869 11.52-11.726 0-.788-.085-1.39-.189-1.989H12.24z" />
                        </svg> Sign up with Google
                    </button>
                    <form id="signup-form-details" class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <input type="text" id="signup-fname" autocomplete="given-name" placeholder="First Name"
                                class="bg-slate-950 border border-slate-800 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-indigo-500"
                                required>
                            <input type="text" id="signup-lname" autocomplete="family-name" placeholder="Last Name"
                                class="bg-slate-950 border border-slate-800 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-indigo-500"
                                required>
                        </div>
                        <input type="text" id="signup-team" autocomplete="organization" placeholder="Team Name"
                            class="w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-indigo-500"
                            required>
                        <input type="email" id="signup-email" autocomplete="email" placeholder="Work Email"
                            class="w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-indigo-500"
                            required>
                        <input type="password" id="signup-password" autocomplete="new-password"
                            placeholder="Create Password"
                            class="w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-indigo-500"
                            required>
                        <button type="submit"
                            class="w-full py-3 bg-white text-slate-900 rounded-full font-medium hover:bg-indigo-50 transition-colors">Continue</button>
                    </form>
                </div>
                <!-- Step 2: Payment -->
                <div id="signup-step-payment" class="hidden">
                    <h2 class="text-2xl font-bold text-white mb-2">Payment Method</h2>
                    <p class="text-slate-400 text-sm mb-6">You won't be charged today.</p>
                    <form id="signup-form-payment" class="space-y-4">
                        <label
                            class="flex items-center gap-4 p-4 border border-slate-700 rounded-xl cursor-pointer hover:bg-slate-800 transition-colors bg-slate-900 group">
                            <input type="radio" name="payment" value="card" checked
                                class="w-5 h-5 text-indigo-500 bg-slate-900 border-slate-600 focus:ring-indigo-500">
                            <span class="font-medium text-white">Credit Card</span>
                        </label>
                        <label
                            class="flex items-center gap-4 p-4 border border-slate-700 rounded-xl cursor-pointer hover:bg-slate-800 transition-colors bg-slate-900 group">
                            <input type="radio" name="payment" value="apple"
                                class="w-5 h-5 text-indigo-500 bg-slate-900 border-slate-600 focus:ring-indigo-500">
                            <span class="font-medium text-white">Apple Pay</span>
                        </label>
                        <button type="submit"
                            class="w-full py-3 bg-white text-slate-900 rounded-full font-medium hover:bg-indigo-50 transition-colors">Confirm
                            & Start</button>
                    </form>
                </div>
                <!-- Step 3: Verify -->
                <div id="signup-step-verify" class="hidden">
                    <h2 class="text-2xl font-bold text-white mb-2 text-center">Verify Email</h2>
                    <p class="text-slate-400 text-center mb-6">Enter code sent to email (Hint: 123456)</p>
                    <form id="verify-form" class="space-y-4">
                        <input type="text" id="verify-code" placeholder="000000" maxlength="6"
                            class="w-full text-center text-2xl tracking-widest bg-slate-950 border border-slate-800 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-indigo-500"
                            required>
                        <div id="verify-error" class="hidden text-red-400 text-sm text-center">Invalid code</div>
                        <button type="submit"
                            class="w-full py-3 bg-white text-slate-900 rounded-full font-medium hover:bg-indigo-50 transition-colors">Verify
                            Email</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- === VIEW 4: DASHBOARD === -->
    <div id="dashboard-view" class="view-section hidden min-h-screen bg-slate-950 flex flex-col md:flex-row">
        <!-- Sidebar -->
        <aside class="w-full md:w-64 bg-slate-900 border-r border-slate-800 flex flex-col">
            <div class="p-6 flex items-center gap-3 border-b border-slate-800">
                <svg viewBox="0 0 40 40" class="w-8 h-8" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 4L5 12.66V27.34L20 36V23L13 19V15L20 11V4Z" fill="#312e81" />
                    <path d="M20 4V11L27 15V19L20 23V36L35 27.34V12.66L20 4Z" fill="#5eead4" />
                </svg>
                <span class="font-bold text-lg text-white">Athplan</span>
            </div>
            <nav class="flex-1 p-4 space-y-1">
                <button onclick="switchDashTab('overview')"
                    class="w-full flex items-center gap-3 px-4 py-3 bg-indigo-500/10 text-indigo-400 rounded-lg text-sm font-medium hover:bg-indigo-500/20 text-left transition-colors">Overview</button>
                <button onclick="switchDashTab('inbox')"
                    class="w-full flex items-center gap-3 px-4 py-3 text-slate-400 hover:bg-slate-800 rounded-lg text-sm font-medium text-left transition-colors">Inbox</button>
                <button onclick="switchDashTab('team')"
                    class="w-full flex items-center gap-3 px-4 py-3 text-slate-400 hover:bg-slate-800 rounded-lg text-sm font-medium text-left transition-colors">Team
                    Roster</button>
                <button onclick="switchDashTab('settings')"
                    class="w-full flex items-center gap-3 px-4 py-3 text-slate-400 hover:bg-slate-800 rounded-lg text-sm font-medium text-left transition-colors">Settings</button>
            </nav>
            <div id="demo-mode-indicator" class="hidden px-4 pb-4">
                <div class="bg-slate-800/50 rounded-lg p-3 border border-slate-700">
                    <p class="text-xs text-slate-400 mb-2">You are viewing Demo Data.</p>
                    <button onclick="setSetupMode('blank')"
                        class="w-full py-2 text-xs font-medium bg-indigo-600 hover:bg-indigo-500 text-white rounded transition-colors">Start
                        Real Setup</button>
                </div>
            </div>
            <div class="p-4 border-t border-slate-800">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center text-white font-bold text-xs"
                        id="user-avatar">U</div>
                    <div class="overflow-hidden">
                        <div class="text-sm font-medium text-white truncate" id="user-name-display">User Name</div>
                        <div class="text-xs text-slate-500 truncate" id="user-team-display">Team</div>
                    </div>
                </div>
                <button onclick="logout()"
                    class="w-full py-2 border border-slate-700 rounded text-xs text-slate-300 hover:text-white transition-colors">Sign
                    Out</button>
            </div>
        </aside>

        <!-- Main Dashboard Content -->
        <main class="flex-1 overflow-y-auto">
            <header
                class="bg-slate-950 border-b border-slate-800 py-6 px-8 flex justify-between items-center sticky top-0 z-10">
                <div>
                    <h1 class="text-2xl font-bold text-white">Dashboard</h1>
                    <div class="flex items-center gap-2 mt-1"><span
                            class="px-2 py-0.5 bg-indigo-500/20 text-indigo-300 rounded text-xs border border-indigo-500/30">14
                            Days Left in Trial</span></div>
                </div>
                <div class="flex items-center gap-4">
                    <button onclick="triggerCrisisMode()"
                        class="px-4 py-1.5 bg-red-900/30 border border-red-500/50 text-red-400 text-xs font-bold rounded-full hover:bg-red-900/50 transition-colors animate-pulse">CRISIS
                        MODE</button>
                    <div
                        class="hidden sm:flex items-center gap-2 px-3 py-1 bg-green-500/10 border border-green-500/20 rounded-full">
                        <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span><span
                            class="text-xs font-medium text-green-500">System Operational</span>
                    </div>
                    <!-- Mobile Sign Out -->
                    <button onclick="logout()" class="md:hidden text-slate-400 hover:text-white text-sm">Sign
                        Out</button>
                </div>
            </header>

            <div class="p-8 max-w-6xl mx-auto">
                <!-- Tab: Overview -->
                <div id="dash-overview" class="dash-tab">

                    <!-- Stats Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-slate-900 border border-slate-800 p-6 rounded-2xl">
                            <div class="text-slate-400 text-sm font-medium mb-2">Queries Today</div>
                            <div class="text-3xl font-bold text-white" id="stat-queries">0</div>
                        </div>
                        <div class="bg-slate-900 border border-slate-800 p-6 rounded-2xl">
                            <div class="text-slate-400 text-sm font-medium mb-2">Active Players</div>
                            <div class="text-3xl font-bold text-white" id="stat-players">0</div>
                        </div>
                        <div class="bg-slate-900 border border-slate-800 p-6 rounded-2xl">
                            <div class="text-slate-400 text-sm font-medium mb-2">Time Saved</div>
                            <div class="text-3xl font-bold text-white" id="stat-time">0 hrs</div>
                        </div>
                    </div>

                    <!-- Activity Log -->
                    <div class="bg-slate-900 border border-slate-800 rounded-2xl overflow-hidden mb-8">
                        <div class="p-6 border-b border-slate-800 flex justify-between items-center">
                            <h3 class="font-bold text-white">Live Activity</h3>
                        </div>
                        <div id="demo-guide-activity"
                            class="hidden bg-indigo-900/20 border-b border-indigo-500/30 p-3 flex gap-3 items-start">
                            <div class="bg-indigo-500/20 p-1 rounded-full shrink-0 mt-0.5"><svg
                                    class="w-4 h-4 text-indigo-300" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg></div>
                            <div>
                                <h4 class="text-indigo-200 font-semibold text-sm mb-1">See it in action</h4>
                                <p class="text-indigo-100/70 text-xs">This log shows real-time interactions. In demo
                                    mode, we simulate player questions.</p>
                            </div>
                        </div>
                        <div id="activity-log-container" class="divide-y divide-slate-800/50 max-h-96 overflow-y-auto">
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                        <!-- Drag & Drop Upload -->
                        <div
                            class="bg-gradient-to-br from-indigo-900/50 to-slate-900 border border-indigo-500/30 p-6 rounded-2xl flex flex-col">
                            <div id="demo-guide-upload"
                                class="hidden mb-4 bg-indigo-500/20 border border-indigo-500/30 rounded-lg p-3">
                                <p class="text-indigo-200 text-xs"><strong>Tip:</strong> Uploading a schedule teaches
                                    the AI. Try dragging a file or clicking "Choose File".</p>
                            </div>
                            <h3 class="font-bold text-white mb-2">Upload Schedule</h3>
                            <p class="text-sm text-slate-400 mb-6">Drag and drop your PDF itinerary here to update the
                                bot's knowledge base.</p>

                            <!-- Drop Zone -->
                            <div id="drop-zone"
                                class="mt-auto border-2 border-dashed border-slate-700 bg-slate-900/50 rounded-xl h-40 flex flex-col items-center justify-center cursor-pointer hover:border-indigo-500 hover:bg-indigo-500/10 transition-all group relative">
                                <input type="file" id="file-input"
                                    class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                                    accept=".pdf,.doc,.docx,.xlsx" onchange="setupFileUpload(this)">
                                <div
                                    class="p-3 bg-slate-800 rounded-full mb-3 group-hover:scale-110 transition-transform pointer-events-none">
                                    <svg class="w-6 h-6 text-indigo-400" fill="none" viewBox="0 0 24 24"
                                        stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                    </svg>
                                </div>
                                <span class="text-sm font-medium text-slate-300 pointer-events-none">Drag & Drop or
                                    <span class="text-indigo-400">Choose File</span></span>
                                <span class="text-xs text-slate-500 mt-1 pointer-events-none">PDF, Excel, Word</span>
                            </div>

                            <div id="upload-progress" class="hidden w-full bg-slate-800 rounded-full h-2.5 mt-4">
                                <div class="bg-indigo-500 h-2.5 rounded-full transition-all duration-200"
                                    style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="bg-slate-900 border border-slate-800 p-6 rounded-2xl flex flex-col">
                            <div id="demo-guide-broadcast"
                                class="hidden mb-4 bg-indigo-500/20 border border-indigo-500/30 rounded-lg p-3">
                                <p class="text-indigo-200 text-xs"><strong>Tip:</strong> Need to reach everyone?
                                    Broadcast sends a WhatsApp alert to all phones instantly.</p>
                            </div>
                            <h3 class="font-bold text-white mb-2">Broadcast Message</h3>
                            <p class="text-sm text-slate-400 mb-6">Send notification to all active players.</p>
                            <button onclick="showBroadcastModal()"
                                class="mt-auto px-4 py-2 bg-slate-800 text-white border border-slate-700 rounded-lg text-sm font-medium hover:bg-slate-700 transition-colors w-full">Draft
                                Message</button>
                        </div>
                    </div>
                </div>

                <!-- Tab: Inbox -->
                <div id="dash-inbox" class="dash-tab hidden">
                    <div class="bg-slate-900 border border-slate-800 rounded-2xl p-8">
                        <h3 class="text-xl font-bold text-white mb-4">Human Handoff Inbox</h3>
                        <p class="text-slate-400 mb-6">Questions the bot is unsure about appear here for manual review.
                        </p>
                        <div
                            class="border border-slate-700 bg-slate-950/50 rounded-lg p-4 flex justify-between items-center">
                            <div><span class="text-yellow-500 text-xs font-bold uppercase tracking-wider">Needs
                                    Review</span>
                                <p class="text-white mt-1">"Is the pool open after 9pm?"</p>
                                <p class="text-xs text-slate-500">From: Mike J. â€¢ 5m ago</p>
                            </div>
                            <button class="px-3 py-1 bg-slate-800 text-white rounded text-sm hover:bg-slate-700">Reply
                                Manually</button>
                        </div>
                    </div>
                </div>

                <!-- Tab: Team -->
                <div id="dash-team" class="dash-tab hidden">
                    <div class="bg-slate-900 border border-slate-800 rounded-2xl p-8 mb-6">
                        <h3 class="text-xl font-bold text-white mb-2">Invite Players</h3>
                        <p class="text-slate-400 mb-6">Skip manual entry. Send this Magic Link to your group chat.</p>
                        <div class="flex gap-2">
                            <input type="text" value="https://athplan.com/join/team-hawks-882" readonly
                                class="flex-1 bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-slate-300">
                            <button onclick="generateMagicLink()"
                                class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-indigo-500">Copy
                                Link</button>
                        </div>
                        <div id="magic-link-toast" class="hidden mt-2 text-green-400 text-sm">Link copied to clipboard!
                        </div>
                    </div>
                </div>
                <div id="dash-settings" class="dash-tab hidden">
                    <div class="p-12 text-center border border-dashed border-slate-800 rounded-2xl">
                        <h3 class="text-xl font-bold text-white mb-2">Settings</h3>
                        <p class="text-slate-400">Manage account details and preferences.</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Broadcast Modal -->
    <div id="broadcast-modal"
        class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-950/80 backdrop-blur-sm">
        <div class="bg-slate-900 border border-slate-800 rounded-2xl p-6 w-full max-w-lg shadow-2xl">
            <h3 class="text-xl font-bold text-white mb-4">Broadcast Message</h3>
            <textarea id="broadcast-text"
                class="w-full h-32 bg-slate-950 border border-slate-800 rounded-lg p-4 text-white focus:outline-none focus:border-indigo-500"
                placeholder="e.g. Bus is leaving in 15 minutes."></textarea>
            <div class="flex justify-end gap-3 mt-4">
                <button onclick="document.getElementById('broadcast-modal').classList.add('hidden')"
                    class="px-4 py-2 text-slate-300 hover:text-white">Cancel</button>
                <button onclick="sendBroadcast()"
                    class="px-4 py-2 bg-white text-slate-900 rounded-lg font-medium hover:bg-indigo-50">Send</button>
            </div>
        </div>
    </div>

    <script>
        /* =========================================
           1. SUPABASE CONFIG & STATE
           ========================================= */
        const supabaseUrl = 'https://haicfgsgimpwnukympab.supabase.co';
        const supabaseKey = 'sb_publishable_TlM38PD842aKFHGgUvmrdQ_wWrdhweW';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        const mockBackend = {
            getUser: async () => {
                const { data: { user } } = await supabase.auth.getUser();
                if (!user) return null;
                // Fetch profile
                const { data: profile } = await supabase.from('users').select('*').eq('id', user.id).single();
                return profile ? { ...user, ...profile } : user;
            },
            login: async (email, password) => {
                const { data, error } = await supabase.auth.signInWithPassword({ email, password });
                if (error) return { success: false, message: error.message };
                return { success: true, user: data.user };
            },
            signup: async (dataBody) => {
                // Store metadata for after signup (or use metadata in signUp)
                const { email, password, firstName, lastName, team } = dataBody;
                const { data, error } = await supabase.auth.signUp({
                    email,
                    password,
                    options: {
                        data: {
                            first_name: firstName,
                            last_name: lastName,
                            team: team
                        }
                    }
                });

                if (error) return { success: false, message: error.message };
                // Create profile record (triggered by webhook usually, but we can try client side if needed/allowed)
                // For now, assume a trigger or we insert manually.
                // Let's insert profile manually to ensure its there
                const { error: profileError } = await supabase.from('users').insert({
                    id: data.user.id,
                    email,
                    first_name: firstName,
                    last_name: lastName,
                    team,
                    plan: 'trial' // default
                });

                if (profileError) console.error("Profile creation failed", profileError);

                return { success: true };
            },
            confirmPayment: async (paymentMethod) => {
                // In a real app we'd update the subscription.
                // Here we just update the user profile
                const { data: { user } } = await supabase.auth.getUser();
                if (user) {
                    await supabase.from('users').update({ payment_method: paymentMethod }).eq('id', user.id);
                }
                return { success: true };
            },
            verify: async (code) => {
                // Supabase verification is usually link-based or code-based.
                // For simplicity in this landing page demo we might skip or use verifyOtp if enabled.
                // But the UI expects a code entry "123456".
                // If we want to simulate it or actually use it:
                // For now, let's just allow it if we are already logged in (which signUp sometimes does automatically)
                // OR we can implement verifyOtp.
                // Assuming email confirmation is OFF for this demo project to make it smooth.
                return { success: true };
            },
            logout: async () => {
                await supabase.auth.signOut();
                window.location.reload();
            }
        };

        let activityLogs = [];
        let currentMode = 'undecided';

        // Load Data
        async function loadPricing() {
            const container = document.getElementById('pricing-container');
            if (!container) return;

            let plans = [];

            try {
                const { data, error } = await supabase.from('pricing_plans').select('*').order('display_order');
                if (!error && data && data.length > 0) {
                    plans = data;
                } else {
                    throw new Error("No plans found");
                }
            } catch (err) {
                console.warn("Using default pricing plans");
                plans = [
                    {
                        name: "Starter",
                        price: "$0",
                        period: "/mo",
                        is_highlighted: false,
                        features: JSON.stringify(["Up to 5 Users", "Basic Schedule Upload", "Email Support"])
                    },
                    {
                        name: "Pro",
                        price: "$49",
                        period: "/mo",
                        is_highlighted: true,
                        features: JSON.stringify(["Up to 20 Users", "Unlimited Uploads", "Priority Support", "Advanced Analytics"])
                    },
                    {
                        name: "Enterprise",
                        price: "$199",
                        period: "/mo",
                        is_highlighted: false,
                        features: JSON.stringify(["Unlimited Users", "Custom Integration", "Dedicated Success Manager", "SLA"])
                    }
                ];
            }

            container.innerHTML = plans.map(plan => `
                <div class="relative rounded-2xl p-8 flex flex-col border transition-all duration-300 ${plan.is_highlighted ? 'bg-slate-900/80 border-indigo-500 shadow-[0_0_40px_rgba(99,102,241,0.15)] transform md:-translate-y-4' : 'bg-slate-950 border-slate-800 hover:border-slate-700'}">
                    ${plan.is_highlighted ? '<div class="absolute -top-4 left-1/2 -translate-x-1/2 bg-indigo-500 text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wide">Most Popular</div>' : ''}
                    <h3 class="text-lg font-medium text-white mb-2">${plan.name}</h3>
                    <div class="flex items-baseline gap-1"><span class="text-4xl font-bold text-white">${plan.price}</span><span class="text-slate-500">${plan.period}</span></div>
                    <ul class="space-y-4 my-8 text-sm text-slate-300">
                        ${JSON.parse(plan.features).map(feat => `
                            <li class="flex items-start gap-3">
                                <svg class="w-5 h-5 ${plan.is_highlighted ? 'text-indigo-400' : 'text-slate-600'}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12" /></svg> 
                                ${feat}
                            </li>
                        `).join('')}
                    </ul>
                    <button onclick="window.dispatchEvent(new CustomEvent('open-payment-modal'))" class="w-full py-2 rounded-full transition-colors ${plan.is_highlighted ? 'bg-white text-slate-900 hover:bg-indigo-50 shadow-glow' : 'bg-transparent border border-slate-700 text-slate-300 hover:bg-slate-800 hover:text-white'}">Subscribe Now</button>
                </div>
            `).join('');
        }

        async function fetchActivityLogs() {
            const { data, error } = await supabase.from('activity_logs').select('*').order('created_at', { ascending: false }).limit(20);
            if (data) {
                activityLogs = data.map(log => ({
                    ...log,
                    time: new Date(log.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) // Simple formatting
                }));
                renderActivityLog();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadPricing();
            // Poll for activity logs
            fetchActivityLogs();
            setInterval(fetchActivityLogs, 30000);
        });

        /* =========================================
           2. NAVIGATION & UI LOGIC
           ========================================= */

        window.navigateTo = (viewId) => {
            // Hide all views
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            const target = document.getElementById(viewId);
            if (target) target.classList.remove('hidden');
            window.scrollTo({ top: 0 });

            const user = mockBackend.getUser();
            const guestNav = document.getElementById('auth-buttons-guest');
            const userNav = document.getElementById('auth-buttons-user');
            const navbar = document.getElementById('navbar');

            // Navbar Logic: Hide main navbar when in dashboard
            if (viewId === 'dashboard-view') {
                navbar.classList.add('hidden');
            } else {
                navbar.classList.remove('hidden');
            }

            if (user) {
                guestNav.classList.add('hidden');
                userNav.classList.remove('hidden');
                if (viewId === 'dashboard-view') {
                    document.getElementById('user-name-display').innerText = user.firstName + ' ' + user.lastName;
                    document.getElementById('user-team-display').innerText = user.team;
                    document.getElementById('user-avatar').innerText = user.firstName.charAt(0);

                    // Show Onboarding Modal if state not set
                    if (currentMode === 'undecided') {
                        document.getElementById('onboarding-modal').classList.remove('hidden');
                    }
                }
            } else {
                guestNav.classList.remove('hidden');
                userNav.classList.add('hidden');
                if (viewId === 'dashboard-view') navigateTo('login-view');
            }
        };

        window.setSetupMode = (mode) => {
            currentMode = mode;
            document.getElementById('onboarding-modal').classList.add('hidden');

            const demoGuides = ['demo-guide-activity', 'demo-guide-upload', 'demo-guide-broadcast'];
            const demoIndicator = document.getElementById('demo-mode-indicator');

            if (mode === 'demo') {
                activityLogs = [
                    { id: 1, time: '2m ago', user: 'Mike J.', query: 'Bus departure time?', status: 'Answered' },
                    { id: 2, time: '15m ago', user: 'Sarah T.', query: 'What is the dress code?', status: 'Answered' },
                    { id: 3, time: '1h ago', user: 'Tom B.', query: 'Gym location', status: 'Answered' },
                    { id: 4, time: '2h ago', user: 'System', query: 'Syncing Flight AA123...', status: 'Processed' },
                ];
                document.getElementById('stat-queries').innerText = '24';
                document.getElementById('stat-players').innerText = '18';
                document.getElementById('stat-time').innerText = '1.5 hrs';

                demoGuides.forEach(id => document.getElementById(id).classList.remove('hidden'));
                demoIndicator.classList.remove('hidden');
            } else {
                activityLogs = [];
                document.getElementById('stat-queries').innerText = '0';
                document.getElementById('stat-players').innerText = '0';
                document.getElementById('stat-time').innerText = '0 hrs';

                demoGuides.forEach(id => document.getElementById(id).classList.add('hidden'));
                demoIndicator.classList.add('hidden');
            }
            renderActivityLog();
        };

        window.scrollToId = (id) => {
            navigateTo('home-view');
            setTimeout(() => {
                const el = document.getElementById(id);
                if (el) {
                    const y = el.getBoundingClientRect().top + window.scrollY - 80;
                    window.scrollTo({ top: y, behavior: 'smooth' });
                }
            }, 100);
        };

        window.switchDashTab = (tabName) => {
            document.querySelectorAll('.dash-tab').forEach(el => el.classList.add('hidden'));
            const target = document.getElementById(`dash-${tabName}`);
            if (target) target.classList.remove('hidden');
        };

        window.goToStep = (stepId) => {
            document.getElementById('signup-step-1').classList.add('hidden');
            document.getElementById('signup-step-payment').classList.add('hidden');
            document.getElementById('signup-step-verify').classList.add('hidden');
            document.getElementById(stepId).classList.remove('hidden');
        };

        /* =========================================
           3. ROI CALCULATOR LOGIC
           ========================================= */

        const ROI = {
            users: 15,
            msgs: 10,
            hourlyRate: 40,
            minsPerMsg: 2,

            init: function () {
                const userSlider = document.getElementById('roi-users');
                const msgSlider = document.getElementById('roi-msgs');

                if (!userSlider || !msgSlider) return;

                userSlider.addEventListener('input', (e) => {
                    this.users = parseInt(e.target.value);
                    this.calculate();
                });

                msgSlider.addEventListener('input', (e) => {
                    this.msgs = parseInt(e.target.value);
                    this.calculate();
                });

                this.calculate();
            },

            calculate: function () {
                // Calculations
                const totalMessagesPerWeek = this.users * this.msgs;
                const minutesSavedPerWeek = totalMessagesPerWeek * this.minsPerMsg;
                const hoursSavedPerWeek = minutesSavedPerWeek / 60;
                const hoursSavedPerMonth = hoursSavedPerWeek * 4;
                const grossValueSaved = hoursSavedPerMonth * this.hourlyRate;

                // Plan Logic
                let planName = 'Starter Pack';
                let planCost = 99;

                if (this.users > 8 && this.users <= 20) {
                    planName = 'All Star';
                    planCost = 199;
                } else if (this.users > 20 && this.users <= 30) {
                    planName = 'Hall of Fame';
                    planCost = 249;
                } else if (this.users > 30) {
                    planName = 'Enterprise';
                    planCost = 0; // Custom
                }

                const netSavings = planCost > 0 ? grossValueSaved - planCost : grossValueSaved;

                // DOM Updates
                document.getElementById('roi-users-val').innerText = `${this.users} Users`;
                document.getElementById('roi-msgs-val').innerText = `${this.msgs} msgs`;

                document.getElementById('roi-time-saved').innerText = hoursSavedPerMonth.toFixed(1);
                document.getElementById('roi-value-saved').innerText = Math.floor(grossValueSaved).toLocaleString();

                document.getElementById('roi-plan-name').innerText = planName;

                if (planCost > 0) {
                    document.getElementById('roi-plan-cost').innerText = `$${planCost}`;
                    document.getElementById('roi-plan-period').innerText = '/mo';
                    document.getElementById('roi-net-savings').innerText = Math.floor(netSavings).toLocaleString();
                } else {
                    document.getElementById('roi-plan-cost').innerText = 'Contact Sales';
                    document.getElementById('roi-plan-period').innerText = '';
                    document.getElementById('roi-net-savings').innerText = Math.floor(grossValueSaved).toLocaleString() + '*';
                }

                // Highlight Pricing Card based on users
                this.highlightPricingCard(planName);
            },

            highlightPricingCard: function (planName) {
                // Reset classes
                const starter = document.getElementById('price-card-starter');
                const allstar = document.getElementById('price-card-allstar');
                const hof = document.getElementById('price-card-hof');

                const cards = [starter, allstar, hof];

                cards.forEach(card => {
                    if (!card) return;
                    card.classList.remove('border-indigo-500', 'bg-slate-900', 'scale-105');
                    card.classList.add('border-slate-800', 'bg-slate-950');
                });

                if (planName === 'Starter Pack' && starter) {
                    starter.classList.add('border-indigo-500', 'bg-slate-900', 'scale-105');
                    starter.classList.remove('border-slate-800', 'bg-slate-950');
                } else if (planName === 'All Star' && allstar) {
                    allstar.classList.add('border-indigo-500', 'bg-slate-900', 'scale-105');
                    allstar.classList.remove('border-slate-800', 'bg-slate-950');
                } else if (planName === 'Hall of Fame' && hof) {
                    hof.classList.add('border-indigo-500', 'bg-slate-900', 'scale-105');
                    hof.classList.remove('border-slate-800', 'bg-slate-950');
                }
            }
        };


        /* =========================================
           4. FILE UPLOAD LOGIC (Triggered by File Input or Drag/Drop)
           ========================================= */

        window.setupFileUpload = (input) => {
            if (input.files && input.files[0]) {
                simulateFileUpload(input.files[0].name);
            }
        };

        window.simulateFileUpload = (fileName) => {
            const progress = document.getElementById('upload-progress');
            const bar = progress.firstElementChild;
            const dropZone = document.getElementById('drop-zone');

            // Show progress
            progress.classList.remove('hidden');

            let width = 0;
            const interval = setInterval(() => {
                if (width >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        activityLogs.unshift({
                            id: Date.now(),
                            time: 'Just now',
                            user: 'System',
                            query: `Agent Reading: "${fileName}"...`,
                            status: 'Processing'
                        });
                        renderActivityLog();

                        // Second phase: Agent finished reading
                        setTimeout(() => {
                            activityLogs.unshift({
                                id: Date.now(),
                                time: 'Just now',
                                user: 'System',
                                query: `Knowledge Base Updated: "${fileName}"`,
                                status: 'Active'
                            });
                            renderActivityLog();
                            progress.classList.add('hidden');
                            width = 0;
                            bar.style.width = '0%';
                            alert("File uploaded. Agent has read the document and updated the team knowledge base.");
                        }, 1500);

                    }, 500);
                } else {
                    width += 10;
                    bar.style.width = width + '%';
                }
            }, 100);
        };

        // Drag and Drop Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            ROI.init(); // Initialize ROI Calculator

            const dropZone = document.getElementById('drop-zone');
            if (dropZone) {
                dropZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropZone.classList.add('drag-active');
                });

                dropZone.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    dropZone.classList.remove('drag-active');
                });

                dropZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropZone.classList.remove('drag-active');
                    if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                        const file = e.dataTransfer.files[0];
                        simulateFileUpload(file.name);
                    }
                });
            }
        });

        /* =========================================
           1. SUPABASE INTEGATION
           ========================================= */

        const SUPABASE_URL = 'https://haicfgsgimpwnukympab.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhhaWNmZ3NnaW1wd251a3ltcGFiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3NDE0MDQsImV4cCI6MjA4MzMxNzQwNH0.iUU5LlmC3L59eqN7F_MDS7g89hBg-lSlJlKNEAtmSCw';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        const mockBackend = {
            getUser: async () => {
                const { data: { user } } = await supabase.auth.getUser();
                if (!user) return null;
                // Map Supabase user to App user format
                return {
                    id: user.id,
                    email: user.email,
                    firstName: user.user_metadata.firstName || 'User',
                    lastName: user.user_metadata.lastName || '',
                    team: user.user_metadata.team || 'My Team',
                    role: 'admin'
                };
            },
            login: async (email, password) => {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email,
                    password
                });
                if (error) {
                    return { success: false, message: error.message };
                }
                const user = data.user;
                return {
                    success: true,
                    user: {
                        id: user.id,
                        email: user.email,
                        firstName: user.user_metadata.firstName || 'User',
                        lastName: user.user_metadata.lastName || '',
                        team: user.user_metadata.team || 'My Team'
                    }
                };
            },
            signup: async (data) => { // Removed 'password' as separate arg, using data.password
                // Store registration data temporarily until payment/verification
                // In a real app, you might create the user here or wait.
                // For this flow, we'll create the user immediately to simplify.
                const { data: user, error } = await supabase.auth.signUp({
                    email: data.email,
                    password: data.password, // Use data.password
                    options: {
                        data: {
                            firstName: data.firstName,
                            lastName: data.lastName,
                            team: data.team
                        }
                    }
                });

                if (error) return { success: false, message: error.message };

                // Mimic the existing flow where we wait for payment/verify
                localStorage.setItem('athplan_pending_email', data.email);
                return { success: true };
            },
            confirmPayment: async (paymentMethod) => {
                // In a real app, process payment here.
                return { success: true };
            },
            verify: async (code) => {
                // Supabase doesn't support manual code verification for email signup 
                // easily without a backend or disabling email confirm.
                // For this demo/landing page, we will assume auto-confirm is ON 
                // OR we just log them in if they exist.
                // However, `signUp` usually returns a session if auto-confirm is on.

                // If we need to verify an OTP (e.g. mobile), we'd use verifyOtp.
                // For email links, Supabase handles it.
                // IMPORTANT: For this specific "Verify" UI step which asks for a code '123456',
                // we'll keep the mock logic OR try to verify an OTP if we sent one.
                // Since we didn't send a real OTP, we'll just check if we have a session.

                const pendingEmail = localStorage.getItem('athplan_pending_email');
                if (!pendingEmail) return { success: false, message: "No pending signup found" };

                // HACK for demo: If code is '123456', we consider it "verified" 
                // and try to reload user. In reality, user needs to click email link.
                if (code === '123456') {
                    // In a real scenario, after a successful signup, the user would be redirected
                    // or their session would be active. For this demo, we simulate a successful
                    // verification leading to a user object.
                    // A more robust solution would involve checking the actual Supabase session.
                    const { data: { user } } = await supabase.auth.getUser();
                    if (user && user.email === pendingEmail) {
                        localStorage.removeItem('athplan_pending_email'); // Clear pending state
                        return { success: true, user: { email: user.email, firstName: user.user_metadata.firstName || 'New', lastName: user.user_metadata.lastName || 'User' } };
                    }
                }
                return { success: false, message: "Invalid code or user not verified" };
            },
            logout: async () => {
                await supabase.auth.signOut();
                window.location.reload();
            }
        };

        /* =========================================
           5. FORM HANDLERS & AUTH
           ========================================= */

        // Login Handler
        const loginForm = document.getElementById('login-form');
        if (loginForm) {
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const btn = e.target.querySelector('button');
                const originalText = btn.innerText;
                btn.innerText = "Signing in...";

                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;

                const res = await mockBackend.login(email, password);
                if (res.success) {
                    navigateTo('dashboard-view');
                } else {
                    document.getElementById('login-error').classList.remove('hidden');
                    btn.innerText = originalText;
                }
            });
        }

        // Signup Handlers
        const signupFormDetails = document.getElementById('signup-form-details');
        if (signupFormDetails) {
            signupFormDetails.addEventListener('submit', async (e) => {
                e.preventDefault();
                const btn = e.target.querySelector('button');
                btn.innerText = "Processing...";
                const data = {
                    firstName: document.getElementById('signup-fname').value,
                    lastName: document.getElementById('signup-lname').value,
                    team: document.getElementById('signup-team').value,
                    email: document.getElementById('signup-email').value,
                    password: document.getElementById('signup-password').value,
                };
                await mockBackend.signup(data);
                goToStep('signup-step-payment');
                btn.innerText = "Continue";
            });
        }

        const signupFormPayment = document.getElementById('signup-form-payment');
        if (signupFormPayment) {
            signupFormPayment.addEventListener('submit', async (e) => {
                e.preventDefault();
                const btn = e.target.querySelector('button');
                btn.innerText = "Setting up...";
                const paymentMethod = document.querySelector('input[name="payment"]:checked').value;
                await mockBackend.confirmPayment(paymentMethod);
                goToStep('signup-step-verify');
                btn.innerText = "Confirm & Start";
            });
        }

        const verifyForm = document.getElementById('verify-form');
        if (verifyForm) {
            verifyForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const res = await mockBackend.verify(document.getElementById('verify-code').value);
                if (res.success) navigateTo('dashboard-view');
                else document.getElementById('verify-error').classList.remove('hidden');
            });
        }

        window.logout = () => mockBackend.logout();
        window.handleGoogleAuth = () => {
            alert("Simulating Google Auth provider...");
            setTimeout(() => {
                const mockUser = { firstName: 'Alex', lastName: 'Google', team: 'Pilot Team', email: 'alex@gmail.com' };
                localStorage.setItem('athplan_session', JSON.stringify(mockUser));
                window.location.reload();
            }, 1000);
        };

        /* =========================================
           6. DASHBOARD ACTIONS
           ========================================= */

        function renderActivityLog() {
            const container = document.getElementById('activity-log-container');
            container.innerHTML = '';

            if (activityLogs.length === 0) {
                container.innerHTML = '<div class="p-8 text-center text-slate-500">No activity yet. Upload a schedule or click \'Start From Scratch\' to begin.</div>';
                return;
            }

            activityLogs.forEach(log => {
                const div = document.createElement('div');
                div.className = "p-4 flex items-center justify-between hover:bg-slate-800/50 transition-colors animate-fade-in";
                div.innerHTML = `
                     <div class="flex items-center gap-4">
                        <div class="w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 bg-slate-800 text-slate-400">
                          ${log.user.charAt(0)}
                        </div>
                        <div>
                          <div class="text-sm text-white font-medium">${log.query}</div>
                          <div class="text-xs text-slate-500">${log.user} â€¢ ${log.time}</div>
                        </div>
                      </div>
                      <div class="flex items-center gap-2">
                        <span class="text-xs font-medium text-green-400">${log.status}</span>
                      </div>
                `;
                container.appendChild(div);
            });
        }

        window.showBroadcastModal = () => document.getElementById('broadcast-modal').classList.remove('hidden');
        window.sendBroadcast = () => {
            const txt = document.getElementById('broadcast-text').value;
            if (!txt) return;
            document.getElementById('broadcast-modal').classList.add('hidden');
            activityLogs.unshift({ id: Date.now(), time: 'Just now', user: 'Admin', query: `Broadcast: "${txt}"`, status: 'Sent' });
            renderActivityLog();
            document.getElementById('broadcast-text').value = '';
        };

        window.generateMagicLink = () => {
            const toast = document.getElementById('magic-link-toast');
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 2000);
        };

        window.triggerCrisisMode = () => {
            if (confirm("ACTIVATE CRISIS MODE? This will send an immediate alert to all players bypassing normal AI filters.")) {
                alert("CRISIS ALERT SENT: 'Check phones immediately for admin instructions.'");
                activityLogs.unshift({ id: Date.now(), time: 'Just now', user: 'ADMIN', query: 'CRISIS ALERT BROADCAST', status: 'URGENT' });
                renderActivityLog();
            }
        };

        // Scroll Animations
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.querySelectorAll('.transition-element').forEach(el => el.classList.add('visible'));
                }
            });
        }, { threshold: 0.1 });
        document.querySelectorAll('.scroll-trigger').forEach(el => observer.observe(el));

        // Initial Navigation Check
        (async () => {
            const user = await mockBackend.getUser();
            if (user) {
                // Update UI with user info
                document.getElementById('user-name-display').innerText = user.first_name + ' ' + user.last_name;
                document.getElementById('user-team-display').innerText = user.team;
                document.getElementById('user-avatar').innerText = user.first_name ? user.first_name.charAt(0) : 'U';

                // If logged in, go to dashboard
                navigateTo('dashboard-view');
            } else {
                // If not, go home
                navigateTo('home-view');
            }
        })();
    </script>
    <script type="module" src="/index.tsx"></script>
</body>

</html>